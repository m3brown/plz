- id: publish
  name: publish
  cmd:
  # Confirm we're on the master branch
  - bash -c "git rev-parse --abbrev-ref HEAD | xargs -I {} bash -c '[ {} == master ] || (echo Please checkout master branch for publishing && exit 1)'"
  # Confirm we're up to date with remote origin
  - bash -c "git fetch origin; git diff --quiet -- ...remotes/origin/HEAD || (echo Please fetch latest commits from origin && exit 1)"
  # Confirm there aren not any local, uncommitted changes
  - bash -c "git diff-index --quiet HEAD -- || (echo Please revert or PR local changes to origin && exit 1)"
  # Confirm all tests are passing
  - bash -c "plz test || (echo Please fix the tests and try again && exit 1)"
  # Publish to pypi
  - rm -f dist/*
  - pipenv run python setup.py sdist bdist_wheel
  - pipenv run twine upload dist/*
  # Create tag and push to remote origin
  - bash -c "python setup.py --version | xargs -I {} bash -c 'git tag -a {} -m {} && git push origin {}'"

- id: test
  name: test code
  cmd:
  - pipenv run pytest
- id: setup
  name: set up development environment
  cmd:
  - pipenv sync --dev
  - pipenv run pre-commit install
